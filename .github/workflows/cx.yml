name: "Monitor CxOne Comment and run Mobb Fixer"

on:
  issue_comment:
    types: [created]

jobs:
  scan-and-fix:
    name: Issue Comment
    if: ${{ github.event.issue.pull_request && contains(github.event.comment.body,'Checkmarx One â€“ Scan Summary & Details') }} # This makes sure that the comment originates from a PR and not an issue comment
    runs-on: 'ubuntu-latest'
    timeout-minutes: 360
    permissions:
      pull-requests: write
      statuses: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run Mobb GH Fixer monitor for CxOne Comments
        if: always()
        uses: mobb-dev/cx-mobb-fixer-action@main
        with:
          cx-tenant: ${{secrets.CX_TENANT }}
          cx-api-token: ${{ secrets.CX_API_TOKEN  }}
          cx-base-uri: ${{ secrets.CX_BASE_URI }}
          cx-base-auth-uri: ${{ secrets.CX_BASE_AUTH_URI  }}
          api-key: ${{ secrets.MOBB_API_TOKEN }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
